{
  "hash": "c25572066fb04552b8de6713338e4e5e",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Monitoramento de Frota de Ônibus\"\nauthor: \"Luiz Alberigi\"\ndate: \"2025-11-20\"\ncategories: [monitoramento, code, python, onibus]\nimage: \"Entrega-Blog_Entrega_blog_2.png\"\njupyter: python3\n---\n\nEste post desenvolve um mapa com os pontos de parada de uma linha de ônibus (marcados com pins) e também apresenta a posição real de onde está ônibus no momento. A linha de ônibus utilizada é 7049-10\n\n::: {#23ad0333 .cell execution_count=1}\n``` {.python .cell-code}\nimport requests\nimport folium\nfrom IPython.display import display\n\n# ==============================\n# CONFIGURAÇÃO\n# ==============================\nTOKEN = \"c0b41dad848fe108b36f55a0649798f350251b9e448c364f8afca955041ad382\"\nCODIGO_LINHA = 1912  # 7049-10\n\n# Paradas manuais (adicione as suas)\nPARADAS = [\n    (-23.62050, -46.76090, \"Parada 1\"),\n    (-23.62210, -46.75970, \"Parada 2\"),\n    (-23.62480, -46.75700, \"Parada 3\"),\n]\n\n# ==============================\n# AUTENTICAR\n# ==============================\ns = requests.Session()\nauth = s.post(\n    \"http://api.olhovivo.sptrans.com.br/v2.1/Login/Autenticar\",\n    params={\"token\": TOKEN}\n)\n\nif auth.text.strip().lower() != \"true\":\n    raise Exception(\"Falha ao autenticar. Resposta da API: \" + auth.text)\n\n# ==============================\n# POSIÇÃO DOS ÔNIBUS EM TEMPO REAL (ENDPOINT CORRETO)\n# ==============================\nbus_resp = s.get(\n    \"http://api.olhovivo.sptrans.com.br/v2.1/Posicao/Linha\",\n    params={\"codigoLinha\": CODIGO_LINHA}\n)\n\ndados = bus_resp.json()\n\n# Lista de ônibus: lat, lon, prefixo\nbus_positions = [\n    (v[\"py\"], v[\"px\"], v[\"p\"])\n    for v in dados.get(\"vs\", [])\n]\n\nprint(\"Ônibus encontrados:\", len(bus_positions))\n\n# ==============================\n# GERAR MAPA\n# ==============================\n# Centralizar no primeiro ônibus ou numa parada\nif bus_positions:\n    center = (bus_positions[0][0], bus_positions[0][1])\nelse:\n    center = PARADAS[0][:2]\n\nm = folium.Map(location=center, zoom_start=15)\n\n# ---- PARADAS (AZUL)\nfor lat, lon, nome in PARADAS:\n    folium.Marker(\n        location=(lat, lon),\n        popup=f\"Parada: {nome}\",\n        icon=folium.Icon(color=\"blue\", icon=\"info-sign\")\n    ).add_to(m)\n\n# ---- ÔNIBUS (VERMELHO)\nfor lat, lon, prefixo in bus_positions:\n    folium.Marker(\n        location=(lat, lon),\n        popup=f\"Ônibus {prefixo}\",\n        icon=folium.Icon(color=\"red\", icon=\"bus\")\n    ).add_to(m)\n\n# Exibir no Quarto\nm\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nÔnibus encontrados: 5\n```\n:::\n\n::: {.cell-output .cell-output-display execution_count=1}\n```{=html}\n<div style=\"width:100%;\"><div style=\"position:relative;width:100%;height:0;padding-bottom:60%;\"><span style=\"color:#565656\">Make this Notebook Trusted to load map: File -> Trust Notebook</span><iframe srcdoc=\"&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;head&gt;\n    \n    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html; charset=UTF-8&quot; /&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://code.jquery.com/jquery-3.7.1.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/js/bootstrap.bundle.min.js&quot;&gt;&lt;/script&gt;\n    &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.js&quot;&gt;&lt;/script&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/leaflet@1.9.3/dist/leaflet.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap-glyphicons.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.2.0/css/all.min.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdnjs.cloudflare.com/ajax/libs/Leaflet.awesome-markers/2.0.2/leaflet.awesome-markers.css&quot;/&gt;\n    &lt;link rel=&quot;stylesheet&quot; href=&quot;https://cdn.jsdelivr.net/gh/python-visualization/folium/folium/templates/leaflet.awesome.rotate.min.css&quot;/&gt;\n    \n            &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width,\n                initial-scale=1.0, maximum-scale=1.0, user-scalable=no&quot; /&gt;\n            &lt;style&gt;\n                #map_6b150da90c1c606dceda41634b993a92 {\n                    position: relative;\n                    width: 100.0%;\n                    height: 100.0%;\n                    left: 0.0%;\n                    top: 0.0%;\n                }\n                .leaflet-container { font-size: 1rem; }\n            &lt;/style&gt;\n\n            &lt;style&gt;html, body {\n                width: 100%;\n                height: 100%;\n                margin: 0;\n                padding: 0;\n            }\n            &lt;/style&gt;\n\n            &lt;style&gt;#map {\n                position:absolute;\n                top:0;\n                bottom:0;\n                right:0;\n                left:0;\n                }\n            &lt;/style&gt;\n\n            &lt;script&gt;\n                L_NO_TOUCH = false;\n                L_DISABLE_3D = false;\n            &lt;/script&gt;\n\n        \n&lt;/head&gt;\n&lt;body&gt;\n    \n    \n            &lt;div class=&quot;folium-map&quot; id=&quot;map_6b150da90c1c606dceda41634b993a92&quot; &gt;&lt;/div&gt;\n        \n&lt;/body&gt;\n&lt;script&gt;\n    \n    \n            var map_6b150da90c1c606dceda41634b993a92 = L.map(\n                &quot;map_6b150da90c1c606dceda41634b993a92&quot;,\n                {\n                    center: [-23.7116535, -46.777972],\n                    crs: L.CRS.EPSG3857,\n                    ...{\n  &quot;zoom&quot;: 15,\n  &quot;zoomControl&quot;: true,\n  &quot;preferCanvas&quot;: false,\n}\n\n                }\n            );\n\n            \n\n        \n    \n            var tile_layer_3da7be93718dd6926511639fe70f5555 = L.tileLayer(\n                &quot;https://tile.openstreetmap.org/{z}/{x}/{y}.png&quot;,\n                {\n  &quot;minZoom&quot;: 0,\n  &quot;maxZoom&quot;: 19,\n  &quot;maxNativeZoom&quot;: 19,\n  &quot;noWrap&quot;: false,\n  &quot;attribution&quot;: &quot;\\u0026copy; \\u003ca href=\\&quot;https://www.openstreetmap.org/copyright\\&quot;\\u003eOpenStreetMap\\u003c/a\\u003e contributors&quot;,\n  &quot;subdomains&quot;: &quot;abc&quot;,\n  &quot;detectRetina&quot;: false,\n  &quot;tms&quot;: false,\n  &quot;opacity&quot;: 1,\n}\n\n            );\n        \n    \n            tile_layer_3da7be93718dd6926511639fe70f5555.addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var marker_a5719439f3d0578d48d1b198fcc5f9f1 = L.marker(\n                [-23.6205, -46.7609],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_50828cb4e5144f9a72904269e8efc889 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_577f6ea6521bc2fafd0f28b75441443d = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_6e9bd157055a92fd798ec442e5d0dd30 = $(`&lt;div id=&quot;html_6e9bd157055a92fd798ec442e5d0dd30&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: Parada 1&lt;/div&gt;`)[0];\n                popup_577f6ea6521bc2fafd0f28b75441443d.setContent(html_6e9bd157055a92fd798ec442e5d0dd30);\n            \n        \n\n        marker_a5719439f3d0578d48d1b198fcc5f9f1.bindPopup(popup_577f6ea6521bc2fafd0f28b75441443d)\n        ;\n\n        \n    \n    \n                marker_a5719439f3d0578d48d1b198fcc5f9f1.setIcon(icon_50828cb4e5144f9a72904269e8efc889);\n            \n    \n            var marker_a4d864df45455705b95ca2ae982ab400 = L.marker(\n                [-23.6221, -46.7597],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_9c603c5a3c385a63c88bf756c440b987 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_4973ff4dfb00aedd0a106ccaf8fbf1c3 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_99f2a5bac1f4edf9a0eeb44c6d839404 = $(`&lt;div id=&quot;html_99f2a5bac1f4edf9a0eeb44c6d839404&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: Parada 2&lt;/div&gt;`)[0];\n                popup_4973ff4dfb00aedd0a106ccaf8fbf1c3.setContent(html_99f2a5bac1f4edf9a0eeb44c6d839404);\n            \n        \n\n        marker_a4d864df45455705b95ca2ae982ab400.bindPopup(popup_4973ff4dfb00aedd0a106ccaf8fbf1c3)\n        ;\n\n        \n    \n    \n                marker_a4d864df45455705b95ca2ae982ab400.setIcon(icon_9c603c5a3c385a63c88bf756c440b987);\n            \n    \n            var marker_0d57e1a8f3a7ab7f5bc34053a86dc905 = L.marker(\n                [-23.6248, -46.757],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_bec3f4bae6021a647e31b0d576527a03 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;blue&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;info-sign&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_4f17e88e94ee993940723d54e6b8b1bd = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_97223d70bd121a60a55b31b079621242 = $(`&lt;div id=&quot;html_97223d70bd121a60a55b31b079621242&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Parada: Parada 3&lt;/div&gt;`)[0];\n                popup_4f17e88e94ee993940723d54e6b8b1bd.setContent(html_97223d70bd121a60a55b31b079621242);\n            \n        \n\n        marker_0d57e1a8f3a7ab7f5bc34053a86dc905.bindPopup(popup_4f17e88e94ee993940723d54e6b8b1bd)\n        ;\n\n        \n    \n    \n                marker_0d57e1a8f3a7ab7f5bc34053a86dc905.setIcon(icon_bec3f4bae6021a647e31b0d576527a03);\n            \n    \n            var marker_b72ceb5c25ddd35b4a64189652f63694 = L.marker(\n                [-23.7116535, -46.777972],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_4fc749ea261daca56a86b568e4336695 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_84788e8c44c216413c1e6945d03a1701 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_5fa0102e702a09fb26855a3d288f6c53 = $(`&lt;div id=&quot;html_5fa0102e702a09fb26855a3d288f6c53&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Ônibus 78371&lt;/div&gt;`)[0];\n                popup_84788e8c44c216413c1e6945d03a1701.setContent(html_5fa0102e702a09fb26855a3d288f6c53);\n            \n        \n\n        marker_b72ceb5c25ddd35b4a64189652f63694.bindPopup(popup_84788e8c44c216413c1e6945d03a1701)\n        ;\n\n        \n    \n    \n                marker_b72ceb5c25ddd35b4a64189652f63694.setIcon(icon_4fc749ea261daca56a86b568e4336695);\n            \n    \n            var marker_05c1c906c822ed0293d562fc6824f155 = L.marker(\n                [-23.661455500000002, -46.778644],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_369b247f7c6104777e19aba95a2abf74 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_3bb489a66b595f3b71582874aaa4c4f0 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_a96bc8f7e8273884eac98f662ae1e490 = $(`&lt;div id=&quot;html_a96bc8f7e8273884eac98f662ae1e490&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Ônibus 78200&lt;/div&gt;`)[0];\n                popup_3bb489a66b595f3b71582874aaa4c4f0.setContent(html_a96bc8f7e8273884eac98f662ae1e490);\n            \n        \n\n        marker_05c1c906c822ed0293d562fc6824f155.bindPopup(popup_3bb489a66b595f3b71582874aaa4c4f0)\n        ;\n\n        \n    \n    \n                marker_05c1c906c822ed0293d562fc6824f155.setIcon(icon_369b247f7c6104777e19aba95a2abf74);\n            \n    \n            var marker_4115293e8857fd1d764e14ea41022c34 = L.marker(\n                [-23.7116535, -46.777972],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_197c96db2ef6e9e5e7c2e92cd24b474f = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_5dfabddc47f247f42f3f4e1acc5497bf = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_47af19071a7cb5bdeea6e993c71fc0ce = $(`&lt;div id=&quot;html_47af19071a7cb5bdeea6e993c71fc0ce&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Ônibus 78918&lt;/div&gt;`)[0];\n                popup_5dfabddc47f247f42f3f4e1acc5497bf.setContent(html_47af19071a7cb5bdeea6e993c71fc0ce);\n            \n        \n\n        marker_4115293e8857fd1d764e14ea41022c34.bindPopup(popup_5dfabddc47f247f42f3f4e1acc5497bf)\n        ;\n\n        \n    \n    \n                marker_4115293e8857fd1d764e14ea41022c34.setIcon(icon_197c96db2ef6e9e5e7c2e92cd24b474f);\n            \n    \n            var marker_016d291b62a23cda8c8028d5cbef80cf = L.marker(\n                [-23.7116535, -46.777972],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_9e98d781b65a0766ad41b45eebb78709 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_92d24c1d5cbc03d7e91fece70f029fdf = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_81fa0cb20e71e884f897ee8e788a7883 = $(`&lt;div id=&quot;html_81fa0cb20e71e884f897ee8e788a7883&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Ônibus 78182&lt;/div&gt;`)[0];\n                popup_92d24c1d5cbc03d7e91fece70f029fdf.setContent(html_81fa0cb20e71e884f897ee8e788a7883);\n            \n        \n\n        marker_016d291b62a23cda8c8028d5cbef80cf.bindPopup(popup_92d24c1d5cbc03d7e91fece70f029fdf)\n        ;\n\n        \n    \n    \n                marker_016d291b62a23cda8c8028d5cbef80cf.setIcon(icon_9e98d781b65a0766ad41b45eebb78709);\n            \n    \n            var marker_3e235f30f24e8a0c347b63aa16baeb17 = L.marker(\n                [-23.694872, -46.7797925],\n                {\n}\n            ).addTo(map_6b150da90c1c606dceda41634b993a92);\n        \n    \n            var icon_eab992a3fe02dcc9994ab73522bbb7b0 = L.AwesomeMarkers.icon(\n                {\n  &quot;markerColor&quot;: &quot;red&quot;,\n  &quot;iconColor&quot;: &quot;white&quot;,\n  &quot;icon&quot;: &quot;bus&quot;,\n  &quot;prefix&quot;: &quot;glyphicon&quot;,\n  &quot;extraClasses&quot;: &quot;fa-rotate-0&quot;,\n}\n            );\n        \n    \n        var popup_87ce13ffbd35544aa4b2f5b5dab2dd30 = L.popup({\n  &quot;maxWidth&quot;: &quot;100%&quot;,\n});\n\n        \n            \n                var html_11291c64fccc76e9e84a35ec1a4b2daf = $(`&lt;div id=&quot;html_11291c64fccc76e9e84a35ec1a4b2daf&quot; style=&quot;width: 100.0%; height: 100.0%;&quot;&gt;Ônibus 78733&lt;/div&gt;`)[0];\n                popup_87ce13ffbd35544aa4b2f5b5dab2dd30.setContent(html_11291c64fccc76e9e84a35ec1a4b2daf);\n            \n        \n\n        marker_3e235f30f24e8a0c347b63aa16baeb17.bindPopup(popup_87ce13ffbd35544aa4b2f5b5dab2dd30)\n        ;\n\n        \n    \n    \n                marker_3e235f30f24e8a0c347b63aa16baeb17.setIcon(icon_eab992a3fe02dcc9994ab73522bbb7b0);\n            \n&lt;/script&gt;\n&lt;/html&gt;\" style=\"position:absolute;width:100%;height:100%;left:0;top:0;border:none !important;\" allowfullscreen webkitallowfullscreen mozallowfullscreen></iframe></div></div>\n```\n:::\n:::\n\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js\" integrity=\"sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js\" integrity=\"sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}